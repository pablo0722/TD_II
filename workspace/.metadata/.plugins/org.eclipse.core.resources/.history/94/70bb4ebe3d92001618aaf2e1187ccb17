/*
 * header.h
 *
 *  Created on: 18 de ago. de 2016
 *      Author: pablo
 */


#ifndef HEADER_H_
#define HEADER_H_


	#include "FreeRTOS.h"
	#include "task.h"
	#include "board.h"
	#include "chip.h"
	#include "semphr.h"
	#include "queue.h"

	#include <string.h>	// Funcion memset
	#include <math.h>	// Funcion sqrt

		// CMSIS
	#include "arm_math.h"


// ***** PERIFERICOS ***** //
	#define USE_UART	1
	#define USE_ADC		0
	#define USE_DAC		0
	#define USE_FFT		1
// *********************** //


// ***** UTILIDADES ***** //
	#define UART_LOOPBACK	0
	#define UART_FFT 		1
// ********************** //


// ***** FUNCIONES ****** //
	void main_init();

	#if USE_FFT
		void fft_function();
	#endif

	#if USE_UART
		void main_uart();
	#endif
// ********************** //


// ***** VARIABLES GLOBALES ***** //
	#if USE_FFT

		#define     LENGTH_SAMPLES              1024				// Tamanio de los vectores de muestras (son complejos, doble tamanio por real+imaginario)
		#define     FFT_SIZE    	           	LENGTH_SAMPLES/2	// Tamanio del vector del modulo de la FFT (Es un cuarto (1/2) del tamanio original por estar espejado)
		#define 	FFT_TYPE_SIZE				4					// Es el tamanio (en bytes) del tipo de los datos para fft (q31_t => 4, q15_t => 2, etc)
		#define 	FFT_DONE_MAX				UART_FFT			// Cantidad de veces que se usara la FFT

		extern arm_cfft_radix2_instance_q31 fft_inst_q31;			// Estructura para aplicar FFT

		extern volatile q31_t spectrum[FFT_SIZE];					// Espectro de la senal transformada
		extern volatile q31_t mSignalIn[LENGTH_SAMPLES];			// Senal  de entrada. Es vector complejo.
		extern volatile q31_t mFFTOut[LENGTH_SAMPLES];  			// Senal  de salida. Es vector complejo.

		extern uint8_t fft_done;									// Cantidad de veces que se uso la FFT
	#endif

	#if USE_UART
		#define LPC_UARTN 			LPC_UART0				// Numero de UART a utilizar
		#define UARTN_IRQn 			UART0_IRQn				// Numero de UART a utilizar
		#define UARTN_IRQHandler 	UART0_IRQHandler		// Numero de UART a utilizar
		#define UART_RX_DONE_MAX 	UART_LOOPBACK + \		// Cantidad de veces que se usara la UART
									USE_FFT

		#define UART_BAUDRATE 		9600					// Baud rate de la UART

			// Transmit and receive ring buffer sizes
		#define UART_SRB_SIZE 	LENGTH_SAMPLES*FFT_TYPE_SIZE	// Send
		#define UART_RRB_SIZE 	LENGTH_SAMPLES*FFT_TYPE_SIZE	// Receive

			// Transmit and receive buffers
		extern uint8_t rxbuff[UART_RRB_SIZE], txbuff[UART_SRB_SIZE];

			// Transmit and receive ring buffers
		extern RINGBUFF_T txring, rxring;
		extern uint8_t uart_rx_done;							// Cantidad de veces que se uso la UART
	#endif


	#if USE_ADC
		#define ADC_FREQ 20000
		#define ADC_DMA_CANT_MUESTRAS 1
		#define ADC_DMA_CHANNEL 0

		//extern DMA_TransferDescriptor_t DMA_descriptor_ADC;
		extern volatile uint32_t dma_memory_adc[ADC_DMA_CANT_MUESTRAS];
	#endif


	#if USE_DAC
		#define DAC_FREQ ADC_FREQ
		#define DAC_DMA_CANT_MUESTRAS ADC_DMA_CANT_MUESTRAS
		#define DAC_DMA_CHANNEL 1

		//extern DMA_TransferDescriptor_t DMA_descriptor_DAC;
		extern volatile uint16_t dma_memory_dac[DAC_DMA_CANT_MUESTRAS];
	#endif
// ****************************** //


#endif /* HEADER_H_ */
