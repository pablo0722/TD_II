/*
 * procesamiento.c
 *
 *  Created on: 7 de oct. de 2016
 *      Author: Pablo
 */


#include "header.h"


#if USE_FFT
	void fft_function()
	{
		if (uart_rx_done)
		{
			uart_rx_done --;

			const uint16_t fft_length = FFT_SIZE;

			arm_rfft_q31(&fft_inst_q31, mSignalIn, spectrum);
			arm_cmplx_mag_q31(spectrum, spectrum, fft_length);

			fft_done = FFT_DONE_MAX;
		}
	}
#endif


#if USE_UART
	void main_uart()
	{
		#if UART_LOOPBACK
			if (uart_rx_done)
			{
				uart_rx_done --;

				Chip_UART_SendRB(LPC_UART0, &txring, mSignalIn, FFT_SIZE*FFT_TYPE_SIZE);
			}
		#endif

		#if UART_FFT
			if (fft_done)
			{
				fft_done --;

				Chip_UART_SendRB(LPC_UART0, &txring, spectrum, FFT_SIZE/2*FFT_TYPE_SIZE);
			}
		#endif
	}
#endif
